<% if (documentclass == 'ustutt') { %>
%% Clashes with mathdesign
% \PreventPackageFromLoading{amssymb,amsfont}
<%# inspired by https://github.com/programming-journal/programming/blob/main/programming.cls -%>
% Mathdesign spuriously redefines things it should not.
%
\makeatletter
\usepackage{etoolbox}
%
\csedef{P@MDback@fboxrule}{\the\fboxrule}
\csedef{P@MDback@fboxsep}{\the\fboxsep}
\csedef{P@MDback@arrayrulewidth}{\the\arrayrulewidth}
\cslet{P@MDback@bfdefault}{\bfdefault}
\cslet{P@MDback@footnoterule}{\footnoterule}
\cslet{P@MDback@hrulefill}{\hrulefill}
%
\RequirePackage[charter,expert]{mathdesign}
%
\setlength{\fboxrule}{\csuse{P@MDback@fboxrule}}
\setlength{\fboxsep}{\csuse{P@MDback@fboxsep}}
\setlength{\arrayrulewidth}{\csuse{P@MDback@arrayrulewidth}}
\letcs{\bfdefault}{P@MDback@bfdefault}
\letcs{\footnoterule}{P@MDback@footnoterule}
\letcs{\hrulefill}{P@MDback@hrulefill}
% cleanup
\csundef{P@MDback@fboxrule}
\csundef{P@MDback@fboxsep}
\csundef{P@MDback@arrayrulewidth}
\csundef{P@MDback@bfdefault}
\csundef{P@MDback@footnoterule}
\csundef{P@MDback@hrulefill}
%
\makeatother

<% } -%>
<% if ((latexcompiler == "lualatex") || (latexcompiler == "both")) { -%>
<% if (latexcompiler == "both") { -%>
\ifluatex
<% } -%>
<%#
###########################################################################
lualatex
###########################################################################
-%>
\usepackage[no-math]{fontspec}
\usepackage{unicode-math}

<% switch (font) { case "arial": -%>
<%# Arial and LuaLaTeX -%>
<%# -%>
\setmainfont[Ligatures=TeX]{Arial}
\setsansfont[Ligatures=TeX]{Arial}
% Use Inconsolata font (https://ctan.org/pkg/inconsolata)
% See https://tex.stackexchange.com/q/2241/9075 for a list of other alternative mono-spaced fonts
% No [Ligatures=TeX], because we want " rendered as upquotes, not as typographic correct ones
% shapely l, upright quotes
% If it is too large, add ",Scale=.9"
\setmonofont[StylisticSet={1,3}]{Inconsolatazi4}
<% break; case "times": -%>
<%# Times New Roman and LuaLaTeX -%>
<%# -%>
% See https://tug.org/FontCatalogue/texgyretermes/ for more information
\setmainfont{texgyretermes}[
  Extension = .otf,
  UprightFont = *-regular,
  BoldFont = *-bold,
  ItalicFont = *-italic,
  BoldItalicFont = *-bolditalic,
  Ligatures=TeX
]
% See https://tug.org/FontCatalogue/texgyreheros/ for more information
\setsansfont[Scale=.9]{TeX Gyre Heros Regular}
<% if (documentclass == 'lncs') { -%>
% newtxtt looks good with times, but no equivalent for lualatex found,
% therefore tried to replace with inconsolata.
% However, inconsolata does not look good in the context of LNCS ...
%\setmonofont[StylisticSet={1,3},Scale=.9]{inconsolata}
% ... thus, we use the good old Latin Modern Mono font for source code.
\setmonofont{Latin Modern Mono} % "variable=false"
<%# \setmonofont{Latin Modern Mono Prop} % "variable=true" -%>
<% } else { -%>
% shapely l, upright quotes
% Normal scaling is too large --> thus, we use ",Scale=.9"
\setmonofont[StylisticSet={1,3},Scale=.9]{Inconsolatazi4}
<% } -%>
<%  break; default: -%>
<%# "default" font configuration -%>
<% switch (documentclass) { case "ieee": -%>
<%# Default font configuration of the IEEE template is used -%>
<% break; case "ustutt": -%>
<%# see also https://github.com/programming-journal/programming/blob/main/programming.cls -%>
\makeatletter
\setmainfont{XCharter}
\setsansfont[Ligatures=TeX]{Arial}
% Use Inconsolata font (https://ctan.org/pkg/inconsolata)
% See https://tex.stackexchange.com/q/2241/9075 for a list of other alternative mono-spaced fonts
% No [Ligatures=TeX], because we want " rendered as upquotes, not as typographic correct ones
% shapely l, upright quotes
% If it is too large, add ",Scale=.9"
\setmonofont[StylisticSet={1,3}]{Inconsolatazi4}
\makeatother
<% break; case "scientific-thesis": -%>
% TODO
<% break; default: -%>
<%# Default LaTeX Font and LuaLaTeX -%>
<% if (texlive >= 2021) { -%>

% Typewriter font (for source code etc)
% Use New Computer Modern font (Computer Modern is the default LaTeX font; this is the implemented modern variant)
% Source: https://tug.org/FontCatalogue/newcomputermoderntypewriter/

\setmainfont[%
ItalicFont=NewCM10-Italic.otf,%
BoldFont=NewCM10-Bold.otf,%
BoldItalicFont=NewCM10-BoldItalic.otf,%
SmallCapsFeatures={Numbers=OldStyle}]{NewCM10-Regular.otf}

\setsansfont[%
ItalicFont=NewCMSans10-Oblique.otf,%
BoldFont=NewCMSans10-Bold.otf,%
BoldItalicFont=NewCMSans10-BoldOblique.otf,%
SmallCapsFeatures={Numbers=OldStyle}]{NewCMSans10-Regular.otf}

\setmonofont[ItalicFont=NewCMMono10-Italic.otf,%
BoldFont=NewCMMono10-Bold.otf,%
BoldItalicFont=NewCMMono10-BoldOblique.otf,%
SmallCapsFeatures={Numbers=OldStyle}]{NewCMMono10-Regular.otf}

\setmathfont{NewCMMath-Regular.otf}
<% break; } -%>
<% } break; } -%>

% Enable proper ligatures
% For more information see https://ctan.org/pkg/selnolig
% language "english" or "ngerman" is passed to selnolig by the document class
\usepackage{selnolig}
<% } -%>
<% if ((latexcompiler != "lualatex") || (latexcompiler == "both")) { -%>
<% if (latexcompiler == "both") { -%>
\else
<% } -%>
<%#
###########################################################################
pdflatex
###########################################################################
-%>
<% switch (font) { case "arial": -%>
<%# Arial and pdflatex -%>
<%# -%>

% Headings are typset in Helvetica (which is similar to Arial)
\usepackage[scaled=.95]{helvet}
<% break; case "times": -%>
<%# Times New Roman and pdflatex -%>
<%# -%>
\RequirePackage{newtxtext}
\RequirePackage{newtxmath}
\RequirePackage[zerostyle=b,scaled=.9]{newtxtt}
<% break; default: -%>
<%# "default" font configuration / Computer Modern and pdflatex -%>
<% switch (documentclass) { case "ieee": -%>
<%# The default font configuration (Palatino/Palladio) of the IEEE template is used.
In addition, we make the code appear more nice -%>

% use nicer font for code
\usepackage[zerostyle=b,scaled=.75]{newtxtt}
<% break; case "ustutt": -%>
<%# See also https://github.com/programming-journal/programming/blob/main/programming.cls -%>
\usepackage{XCharter}
\usepackage[scaled=.95]{helvet}
<% break; case "scientific-thesis": -%>
% TODO
<% break; default: -%>
% This is the modern package for "Computer Modern".
% In case this gets activated, one has to switch from cmap package to glyphtounicode (in the case of pdflatex)
\usepackage[%
    rm={oldstyle=false,proportional=true},%
    sf={oldstyle=false,proportional=true},%
    % By using 'variable=true' the monospaced font can be used as variable font (with differents widths per letter)
    % However, this makes listings look ugly.
    tt={oldstyle=false,proportional=true,variable=false},%
    qt=false%
]{cfr-lm}
<% } -%>
<% break; } -%>

% Has to be loaded AFTER any font packages. See https://tex.stackexchange.com/a/2869/9075.
\usepackage[T1]{fontenc}
<% if (latexcompiler == "both") { -%>
\fi
<% } -%>
<% } -%>
<% if (documentclass == 'scientific-thesis') { -%>

\usepackage{setspace}
\setstretch{1.2}
<% } -%>
<% if (documentclass == 'ustutt') { -%>

\usepackage{setspace}
\setstretch{1.2}

% Zusatzliche Symbole (Text Companion font extension)
\usepackage{textcomp}

% Symbole Check und Cross
\usepackage{pifont}
\newcommand{\dingcheck}{\ding{51}}
\newcommand{\dingcross}{\ding{55}}
%for scaling see http://tex.stackexchange.com/a/130236/9075

\setkomafont{sectioning}{\normalfont\normalcolor\rmfamily\mdseries}
\setkomafont{descriptionlabel}{\bfseries}
\setkomafont{pageheadfoot}{\small\sffamily}
\setkomafont{pagenumber}{\small\sffamily\bfseries}

\typearea[current]{last}
<% } -%>
